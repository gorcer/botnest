{
    "sourceFile": "sql.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1691561748173,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1691563227905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,16 +17,20 @@\n \n \n \n -- Expected rate\n+\n+\n+\n select \n order_id\n createdAt,\n t.\"elapsedDays\",\n t.\"elapsedSeconds\",\n orderRate,\n currentRate,\n-(orderRate * (1 + (0.00075*2 + expectedProfit/100))) as expectedRate,\n+--(orderRate * (1 + (0.00075*2 + expectedProfit/100))) as expectedRate,\n+(amount2 * (1+expectedProfit/100))/amount1 as expectedRate,\n currentProfit,\n expectedProfit\n from\n (\n@@ -36,9 +40,11 @@\n (extract(epoch from now()) - \"order\".\"createdAtSec\")/60/60/24 as \"elapsedDays\",\n (extract(epoch from now()) - \"order\".\"createdAtSec\") as \"elapsedSeconds\",\n \"order\".\"rate\" as orderRate,\n \"pair\".\"buyRate\" as currentRate,\n-100*(( (\"pair\".\"buyRate\" * ( 1 - 0.00075*2)) / \"order\".\"rate\")-1) as currentProfit,\n+\"order\".amount1,\n+(\"order\".amount2 + \"order\".fee) as amount2,\n+100*(((\"pair\".\"buyRate\" * \"order\".amount1*(1-pair.fee)) / (\"order\".amount2 + \"order\".fee))-1) as currentProfit,\n case\n           when\n             (extract(epoch from now()) - \"order\".\"createdAtSec\") < 86400\n           then\n@@ -56,9 +62,8 @@\n ) as t\n order by expectedRate;\n \n \n-\n -- Expected buy\n \n SELECT \n \"order\".rate,\n"
                }
            ],
            "date": 1691561748173,
            "name": "Commit-0",
            "content": "\n-- Get profit stat\nselect \n t.dt, t.spendUSDT, t.profit, (t.profit / t.spendUSDT)\n from\n (\nSELECT \nTO_CHAR(o.\"createdAt\", 'YYYY-MM-DD') as dt,\nsum(\ncase when type = 'buy' then amount2 else 0 end\n) as spendUSDT,\nsum(profit) as profit\nfrom \"order\" o\ngroup by dt\norder by dt desc\n) as t\n\n\n\n-- Expected rate\nselect \norder_id\ncreatedAt,\nt.\"elapsedDays\",\nt.\"elapsedSeconds\",\norderRate,\ncurrentRate,\n(orderRate * (1 + (0.00075*2 + expectedProfit/100))) as expectedRate,\ncurrentProfit,\nexpectedProfit\nfrom\n(\nSELECT \n\"order\".\"id\" AS \"order_id\",\n\"order\".\"createdAt\",\n(extract(epoch from now()) - \"order\".\"createdAtSec\")/60/60/24 as \"elapsedDays\",\n(extract(epoch from now()) - \"order\".\"createdAtSec\") as \"elapsedSeconds\",\n\"order\".\"rate\" as orderRate,\n\"pair\".\"buyRate\" as currentRate,\n100*(( (\"pair\".\"buyRate\" * ( 1 - 0.00075*2)) / \"order\".\"rate\")-1) as currentProfit,\ncase\n          when\n            (extract(epoch from now()) - \"order\".\"createdAtSec\") < 86400\n          then\n            ( 0.000009512937595 * (extract(epoch from now()) - \"order\".\"createdAtSec\") )\n          else\n            ( 0.000000951293760 * (extract(epoch from now()) - \"order\".\"createdAtSec\") )\n        end as expectedProfit\nFROM \"order\" \"order\" \nINNER JOIN \"pair\" \"pair\" ON \"pair\".\"currency1\" = \"order\".currency1 AND \"pair\".\"currency2\" = \"order\".currency2 \nWHERE \n\t\"order\".side = 'buy' and\t\n\t\"order\".\"createdAtSec\" < extract(epoch from now()) AND \n\t\"order\".\"isActive\" = true AND \n\t\"order\".\"prefilled\" < \"order\".\"amount1\"\n) as t\norder by expectedRate;\n\n\n\n-- Expected buy\n\nSELECT \n\"order\".rate,\n\"pair\".\"sellRate\" * (1-cast(0.001 as decimal)) as from,\n \"pair\".\"sellRate\" * (1+cast(0.001 as decimal)) as to,\n                \"balance\".\"accountId\",\n                \"pair\".\"sellRate\" as \"rate\",\n                GREATEST(cast(0.0001 as DECIMAL), \"pair\".\"minAmount1\") as amount1,\n                \"pair\".currency1,\n                \"pair\".currency2\n                 FROM \"balance\" \"balance\" INNER JOIN \"pair\" \"pair\" ON \"pair\".\"currency2\" = \"balance\".currency  \n                 LEFT JOIN \n\"order\" \"order\" ON\n                    \"order\".currency2 = \"balance\".currency and\n                    \"order\".\"isActive\" = true and\n                    \"order\".\"prefilled\" < \"order\".\"amount1\" and                   \n                    \"order\".rate > \"pair\".\"sellRate\" * (1-cast(0.001 as decimal)) and\n                    \"order\".rate < \"pair\".\"sellRate\" * (1+cast(0.001 as decimal))                     \nWHERE \n--\"order\".id is null AND \n\"balance\".amount > \"pair\".\"minAmount2\" AND \n\"balance\".amount > 0.0001 * \"pair\".\"sellRate\"  \n"
        }
    ]
}